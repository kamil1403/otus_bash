<p align="center">
  <img src="https://github.com/kamil1403/otus_bash/blob/main/screenshots/bash-logo-dark.jpg" alt="Banner" width="65%">
</p>

## ![Lesson](https://img.shields.io/badge/Lesson-otus__bash-0A84FF?style=for-the-badge&logo=linux&logoColor=white&labelColor=111827)![Author](https://img.shields.io/badge/Author-Kamil%20Ibragimov-10B981?style=for-the-badge&logo=github&logoColor=white&labelColor=111827)![Date](https://img.shields.io/badge/Date-20.10.2025-F59E0B?style=for-the-badge&logo=calendar&logoColor=white&labelColor=111827)

### üìå –ó–∞–¥–∞–Ω–∏–µ:   
- [ ] –ù–∞–ø–∏—Å–∞—Ç—å —Å–∫—Ä–∏–ø—Ç –¥–ª—è CRON, –∫–æ—Ç–æ—Ä—ã–π —Ä–∞–∑ –≤ —á–∞—Å –±—É–¥–µ—Ç —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å –ø–∏—Å—å–º–æ –∏ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –Ω–∞ –∑–∞–¥–∞–Ω–Ω—É—é –ø–æ—á—Ç—É
> [!NOTE]
> –ü—Ä–∏–∑–Ω–∞—é—Å—å —á–µ—Å—Ç–Ω–æ üòä - –ø–æ–¥–Ω–∏–º–∞—Ç—å –∏ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å –ø–æ—á—Ç–æ–≤—ã–π —Å–µ—Ä–≤–µ—Ä —Ä–∞–¥–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ –î–ó –±—ã–ª–æ –ª–µ–Ω—å, —Ö–æ—Ç—å –∏ –µ—Å—Ç—å –ø–æ–Ω–∏–º–∞–Ω–∏–µ.
> –ü–æ—ç—Ç–æ–º—É —Ä–µ—à–∏–ª —Å–¥–µ–ª–∞—Ç—å –æ—Ç—á–µ—Ç –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–º —Å–ø–æ—Å–æ–±–æ–º - —á–µ—Ä–µ–∑ Telegram-–±–æ—Ç–∞.

–ù–µ–æ–±—Ö–æ–¥–∏–º–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –≤ –æ—Ç—á–µ—Ç–µ:   
- [ ] –°–ø–∏—Å–æ–∫ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º—ã—Ö URL (—Å –Ω–∞–∏–±–æ–ª—å—à–∏–º –∫–æ–ª-–≤–æ–º –∑–∞–ø—Ä–æ—Å–æ–≤) —Å —É–∫–∞–∑–∞–Ω–∏–µ–º –∫–æ–ª-–≤–∞ –∑–∞–ø—Ä–æ—Å–æ–≤ c –º–æ–º–µ–Ω—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∑–∞–ø—É—Å–∫–∞ —Å–∫—Ä–∏–ø—Ç–∞;         
- [ ] –û—à–∏–±–∫–∏ –≤–µ–±-—Å–µ—Ä–≤–µ—Ä–∞/–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è c –º–æ–º–µ–Ω—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∑–∞–ø—É—Å–∫–∞;   
- [ ] –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∫–æ–¥–æ–≤ HTTP –æ—Ç–≤–µ—Ç–∞ —Å —É–∫–∞–∑–∞–Ω–∏–µ–º –∏—Ö –∫–æ–ª-–≤–∞ —Å –º–æ–º–µ–Ω—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∑–∞–ø—É—Å–∫–∞ —Å–∫—Ä–∏–ø—Ç–∞;
- [ ] –°–∫—Ä–∏–ø—Ç –¥–æ–ª–∂–µ–Ω –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞—Ç—å –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –∑–∞–ø—É—Å–∫ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –∫–æ–ø–∏–π, –¥–æ –µ–≥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è.        

### ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç:   
- [x] –û—Ç—á–µ—Ç —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—è –≤ Telegram-–±–æ—Ç, —Å–æ –≤—Å–µ–π –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –∏–∑ –∑–∞–¥–∞–Ω–∏—è –≤—ã—à–µ. –†–µ–∑—É–ª—å—Ç–∞—Ç —Å–º. –Ω–∞ —Å–∫—Ä–∏–Ω—à–æ—Ç–µ üñºÔ∏è ["log_report_tg"](https://github.com/kamil1403/otus_bash/blob/main/screenshots/log_report_tg.png)     

### üß≠ –û–≥–ª–∞–≤–ª–µ–Ω–∏–µ
- [üß∞ –ö–æ–º–∞–Ω–¥–∞ ‚Ññ1 - "–¢–æ–ø IP –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –∑–∞–ø—Ä–æ—Å–æ–≤"](#one)
- [üß∞ –ö–æ–º–∞–Ω–¥–∞ ‚Ññ2 - "–¢–æ–ø –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º—ã—Ö URL"](#two)
- [üß∞ –ö–æ–º–∞–Ω–¥–∞ ‚Ññ3 - "–û—à–∏–±–∫–∏ –≤–µ–±-—Å–µ—Ä–≤–µ—Ä–∞ / –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (4xx/5xx)"](#three)
- [üß∞ –ö–æ–º–∞–Ω–¥–∞ ‚Ññ4 - "–í—Å–µ –∫–æ–¥—ã HTTP —Å –∏—Ö –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º"](#four)
- [üöÄ –ö—Ä–∞—Ç–∫–∏–π –ø–æ—Ä—è–¥–æ–∫ –¥–µ–π—Å—Ç–≤–∏–π (—Å–æ–∑–¥–∞–Ω–∏–µ –∏ –∑–∞–ø—É—Å–∫ —Å–∫—Ä–∏–ø—Ç–∞)](#start)
- [‚è±Ô∏è –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç–∞ –≤ cron](#cron)
- [üìù –°–æ–¥–µ—Ä–∂–∏–º–æ–µ —Å–∫—Ä–∏–ø—Ç–∞](#script)

---

<a id="one"></a>
## üß∞ –ö–æ–º–∞–Ω–¥–∞ ‚Ññ1 - "–¢–æ–ø IP –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –∑–∞–ø—Ä–æ—Å–æ–≤

```bash
awk '{print $1}' "$LOG_FILE" | sort | uniq -c | sort -nr | head -n 10
```

---

<a id="two"></a>
## üß∞ –ö–æ–º–∞–Ω–¥–∞ ‚Ññ2 ‚Äî ¬´–¢–æ–ø –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º—ã—Ö URL

```bash
awk -F'"' '{print $2}' "$LOG_FILE" | cut -d'/' -f2 | sort | uniq -c | sort -nr | head -n 10
```

---

<a id="three"></a>
## üß∞ –ö–æ–º–∞–Ω–¥–∞ ‚Ññ3 - "–û—à–∏–±–∫–∏ –≤–µ–±-—Å–µ—Ä–≤–µ—Ä–∞ / –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (4xx/5xx)

```bash
awk '$9 ~ /^[45]/ {print $9}' "$LOG_FILE" | sort | uniq -c | sort -nr
```

---

<a id="four"></a>
## üß∞ –ö–æ–º–∞–Ω–¥–∞ ‚Ññ4 - "–í—Å–µ –∫–æ–¥—ã HTTP —Å –∏—Ö –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º

```bash
awk '$9 ~ /^[12345]/ {print $9}' "$LOG_FILE" | sort | uniq -c | sort -nr
```

---

<a id="start"></a>
## üöÄ –ö—Ä–∞—Ç–∫–∏–π –ø–æ—Ä—è–¥–æ–∫ –¥–µ–π—Å—Ç–≤–∏–π (—Å–æ–∑–¥–∞–Ω–∏–µ –∏ –∑–∞–ø—É—Å–∫ —Å–∫—Ä–∏–ø—Ç–∞)

```bash
# ----------------------------- STEP 1 -----------------------------
# –°–æ–∑–¥–∞–µ–º —Ñ–∞–π–ª —Å–∫—Ä–∏–ø—Ç–∞:
touch ~/loglab/log_report.sh

# ----------------------------- STEP 2 -----------------------------
# –°–æ–∑–¥–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω—ã–π —Ñ–∞–π–ª –¥–ª—è –æ—Ç—á–µ—Ç–∞:
touch /tmp/log_report.txt

# ----------------------------- STEP 3 -----------------------------
# –î–µ–ª–∞–µ–º —Å–∫—Ä–∏–ø—Ç –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–º:
chmod +x ~/loglab/log_report.sh

# ----------------------------- STEP 4 -----------------------------
# –ó–∞–ø—É—Å–∫–∞–µ–º –≤—Ä—É—á–Ω—É—é –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏:
./log_report.sh
```

---

<a id="cron"></a>
## ‚è±Ô∏è –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ cron

```bash
# ----------------------------- STEP 1 -----------------------------
# –°–¥–µ–ª–∞—Ç—å —Å–∫—Ä–∏–ø—Ç –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–º:
chmod +x /home/ubuntuserv/loglab/log_report.sh

# ----------------------------- STEP 2 -----------------------------
# –û—Ç–∫—Ä—ã—Ç—å cron:
crontab -e

# ----------------------------- STEP 3 -----------------------------
# –î–æ–±–∞–≤–∏—Ç—å —Å—Ç—Ä–æ–∫—É:
0 * * * * /home/ubuntuserv/loglab/log_report.sh >> /home/ubuntuserv/loglab/cron.log 2>&1
```

---

<a id="script"></a>
## üìù –°–æ–¥–µ—Ä–∂–∏–º–æ–µ —Å–∫—Ä–∏–ø—Ç–∞

```bash
#!/usr/bin/env bash

# –ù–∞—Å—Ç—Ä–æ–π–∫–∏
LOG_FILE="/home/ubuntuserv/loglab/otus.log"
EMAIL="test_otus@gmail.com"

# –í—Ä–µ–º–µ–Ω–Ω—ã–π —Ñ–∞–π–ª –æ—Ç—á—ë—Ç–∞
REPORT_FILE="/tmp/log_report.txt"

# Telegram
BOT_TOKEN="8440377128:AAHI96mV9l62BGDdseZVS3-L9-v_3IVxx2U"
CHAT_ID="580441018"

# –ó–∞–≥–æ–ª–æ–≤–æ–∫ –æ—Ç—á—ë—Ç–∞
{
  echo "–ü–æ—á–∞—Å–æ–≤–æ–π –æ—Ç—á–µ—Ç –∏–∑ –ª–æ–≥–æ–≤"
  echo "–î–∞—Ç–∞: $(date '+%Y-%m-%d %H:%M:%S')"
  echo "–õ–æ–≥-—Ñ–∞–π–ª:  $LOG_FILE"
  echo "----------------------------------------"
  echo
} > "$REPORT_FILE"

# 1) –¢–æ–ø IP-–∞–¥—Ä–µ—Å–æ–≤ (—Ç–æ–ø-10)
{
  echo "–¢–æ–ø IP-–∞–¥—Ä–µ—Å–æ–≤:"
  awk '{print $1}' "$LOG_FILE" | sort | uniq -c | sort -nr | head -n 10
  echo
} >> "$REPORT_FILE"

# 2) –¢–æ–ø –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º—ã—Ö URL
{
  echo "–¢–æ–ø –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º—ã—Ö URL:"
  awk -F'"' '{print $2}' "$LOG_FILE" | cut -d'/' -f2 | sort | uniq -c | sort -nr | head -n 10
  echo
} >> "$REPORT_FILE"

# 3) –û—à–∏–±–∫–∏ –≤–µ–±-—Å–µ—Ä–≤–µ—Ä–∞/–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è c –º–æ–º–µ–Ω—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∑–∞–ø—É—Å–∫–∞ (4xx/5xx)
{
  echo "–û—à–∏–±–∫–∏ (4xx/5xx):"
  awk '$9 ~ /^[45]/ {print $9}' "$LOG_FILE" | sort | uniq -c | sort -nr
  echo
} >> "$REPORT_FILE"

# 4) –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∫–æ–¥–æ–≤ HTTP –æ—Ç–≤–µ—Ç–∞ —Å —É–∫–∞–∑–∞–Ω–∏–µ–º –∏—Ö –∫–æ–ª-–≤–∞ —Å –º–æ–º–µ–Ω—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∑–∞–ø—É—Å–∫–∞ —Å–∫—Ä–∏–ø—Ç–∞
{
  echo "–í—Å–µ –∫–æ–¥—ã HTTP:"
  awk '$9 ~ /^[12345]/ {print $9}' "$LOG_FILE" | sort | uniq -c | sort -nr
  echo
} >> "$REPORT_FILE"

# –û—Ç–ø—Ä–∞–≤–∫–∞ –ø–∏—Å—å–º–∞
#mail -s "[$(hostname)] Hourly Log Report" "$EMAIL" < "$REPORT_FILE"

# –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –ª–æ–≥–∞ –≤ Telegram
TEXT=$(cat "$REPORT_FILE")
curl -s -X POST "https://api.telegram.org/bot${BOT_TOKEN}/sendMessage" \
     -d chat_id="${CHAT_ID}" \
     --data-urlencode "text=$TEXT" >/dev/null
```

---
